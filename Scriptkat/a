-- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
_G.TeleportScript = _G.TeleportScript or {}
local TeleportScript = _G.TeleportScript

-- –°–µ—Ä–≤–∏—Å—ã
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
TeleportScript.Enabled = true
TeleportScript.BackwardOffset = 2 -- –û—Ç—Å—Ç—É–ø –æ—Ç –∏–≥—Ä–æ–∫–∞
TeleportScript.DownwardOffset = 1 -- –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑
TeleportScript.TargetSwitchTime = 10 -- –í—Ä–µ–º—è –¥–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–º–µ–Ω—ã —Ü–µ–ª–∏ (–µ—Å–ª–∏ —Ü–µ–ª—å –Ω–µ —É–º–µ—Ä–ª–∞)
TeleportScript.RandomSwitchInterval = 2 -- –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–ª—É—á–∞–π–Ω–æ–π —Å–º–µ–Ω—ã —Ü–µ–ª–∏ (—Å–µ–∫—É–Ω–¥—ã)
TeleportScript.PriorityTargetChance = 80 -- –®–∞–Ω—Å —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ (80%)
TeleportScript.CurrentTarget = nil
TeleportScript.LastTargetChange = 0
TeleportScript.LastRandomSwitch = 0
TeleportScript.Connection = nil
TeleportScript.CharacterConnection = nil
TeleportScript.InputConnection = nil

-- –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
TeleportScript.ForbiddenPosition = Vector3.new(-6, 958, -42)
TeleportScript.ForbiddenRadius = 10 -- –†–∞–¥–∏—É—Å –≤–æ–∫—Ä—É–≥ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
TeleportScript.SpawnCheckRadius = 25 -- –†–∞–¥–∏—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–æ–Ω—ã —Å–ø–∞–≤–Ω–∞

-- –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —â–∏—Ç–∞
TeleportScript.ShieldKeywords = {
    "shield", "—â–∏—Ç", "barrier", "protection", "defense", "–±–ª–æ–∫", "–∑–∞—â–∏—Ç–∞",
    "forcefield", "energy shield", "energy field", "force field"
}

-- –ö—ç—à –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å–ø–∞–≤–Ω–∞
TeleportScript.SpawnParts = {}
TeleportScript.LastSpawnUpdate = 0

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–ø–∞–≤–Ω–∞
function TeleportScript:UpdateSpawnCache()
    local currentTime = os.time()
    if currentTime - self.LastSpawnUpdate < 5 then return end -- –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    
    self.SpawnParts = {}
    self.LastSpawnUpdate = currentTime
    
    -- –ò—â–µ–º –æ–±—ä–µ–∫—Ç Spawn –≤ workspace
    local spawn = workspace:FindFirstChild("Spawn")
    if not spawn then
        print("‚ö†Ô∏è –û–±—ä–µ–∫—Ç Spawn –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ workspace")
        return
    end
    
    print("üîç –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–ø–∞–≤–Ω–∞...")
    
    -- –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∞—Å—Ç–∏ —Å–ø–∞–≤–Ω–∞
    if spawn:IsA("Part") or spawn:IsA("BasePart") then
        table.insert(self.SpawnParts, spawn)
        print("üìç –ù–∞–π–¥–µ–Ω Spawn Part: " .. spawn.Name)
        
    elseif spawn:IsA("Model") then
        for _, part in ipairs(spawn:GetDescendants()) do
            if part:IsA("BasePart") then
                table.insert(self.SpawnParts, part)
                print("üìç –ù–∞–π–¥–µ–Ω Spawn Part –≤ –º–æ–¥–µ–ª–∏: " .. part.Name)
            end
        end
        
    elseif spawn:IsA("Folder") then
        for _, obj in ipairs(spawn:GetDescendants()) do
            if obj:IsA("BasePart") then
                table.insert(self.SpawnParts, obj)
                print("üìç –ù–∞–π–¥–µ–Ω Spawn Part –≤ –ø–∞–ø–∫–µ: " .. obj.Name)
            end
        end
    end
    
    -- –¢–∞–∫–∂–µ –∏—â–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–æ–Ω —Å–ø–∞–≤–Ω–∞
    local spawnNames = {"SpawnPoint", "SpawnArea", "Respawn", "SafeZone", "SafeArea"}
    for _, name in ipairs(spawnNames) do
        local spawnObj = workspace:FindFirstChild(name)
        if spawnObj then
            if spawnObj:IsA("Part") or spawnObj:IsA("BasePart") then
                table.insert(self.SpawnParts, spawnObj)
                print("üìç –ù–∞–π–¥–µ–Ω " .. name .. ": " .. spawnObj.Name)
            elseif spawnObj:IsA("Model") then
                for _, part in ipairs(spawnObj:GetDescendants()) do
                    if part:IsA("BasePart") then
                        table.insert(self.SpawnParts, part)
                        print("üìç –ù–∞–π–¥–µ–Ω " .. name .. " Part: " .. part.Name)
                    end
                end
            end
        end
    end
    
    print("‚úÖ –ù–∞–π–¥–µ–Ω–æ " .. #self.SpawnParts .. " –æ–±—ä–µ–∫—Ç–æ–≤ —Å–ø–∞–≤–Ω–∞")
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ –≤ –∑–æ–Ω–µ —Å–ø–∞–≤–Ω–∞ (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function TeleportScript:IsInSpawnArea(player)
    if not player or not player.Character then return false end
    
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    -- –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à —Å–ø–∞–≤–Ω–∞
    self:UpdateSpawnCache()
    
    -- –ï—Å–ª–∏ –Ω–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ —Å–ø–∞–≤–Ω–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º false
    if #self.SpawnParts == 0 then
        return false
    end
    
    local playerPosition = humanoidRootPart.Position
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —Å–ø–∞–≤–Ω–∞
    for _, spawnPart in ipairs(self.SpawnParts) do
        local distance = (playerPosition - spawnPart.Position).Magnitude
        
        -- –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω–∞—è —á–∞—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
        if distance <= self.SpawnCheckRadius then
            return true
        end
        
        -- –ï—Å–ª–∏ —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å (—Å —Ä–∞–∑–º–µ—Ä–æ–º), –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏
        if spawnPart:IsA("Part") and spawnPart.Size.Magnitude > 0 then
            local spawnCFrame = spawnPart.CFrame
            local spawnSize = spawnPart.Size
            
            -- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ø–∞–≤–Ω–∞
            local localPos = spawnCFrame:PointToObjectSpace(playerPosition)
            
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ bounding box
            if math.abs(localPos.X) <= spawnSize.X/2 and
               math.abs(localPos.Y) <= spawnSize.Y/2 and
               math.abs(localPos.Z) <= spawnSize.Z/2 then
                return true
            end
        end
    end
    
    return false
end

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function TeleportScript:GetPriorityTarget()
    local success, result = pcall(function()
        -- –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        local targetUI = LocalPlayer.PlayerGui.GameUI.HUD.TargetUI.TargetHolder.TargetName
        if targetUI and targetUI:IsA("TextLabel") then
            local targetName = targetUI.Text
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –ø—É—Å—Ç–æ–π –∏ –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
            if targetName and targetName ~= "" and targetName ~= "No Target" and targetName ~= "None" then
                -- –ò—â–µ–º –∏–≥—Ä–æ–∫–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= LocalPlayer and player.Name == targetName then
                        return player
                    end
                end
            end
        end
        return nil
    end)
    
    if not success then
        return nil
    end
    
    return result
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–Ω–æ –ª–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–≥—Ä–æ–∫—É
function TeleportScript:IsValidTarget(player)
    if not player or not player.Character then 
        return false 
    end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ HumanoidRootPart
    if not player.Character:FindFirstChild("HumanoidRootPart") then
        return false
    end
    
    -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ —Å —â–∏—Ç–æ–º
    if self:HasShield(player) then
        print("üö´ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º " .. player.Name .. " (—â–∏—Ç)")
        return false
    end
    
    -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–π –∑–æ–Ω–µ
    if self:IsInForbiddenArea(player) then
        print("üö´ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º " .. player.Name .. " (–∑–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è –∑–æ–Ω–∞)")
        return false
    end
    
    -- –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–æ–Ω–µ —Å–ø–∞–≤–Ω–∞
    if self:IsInSpawnArea(player) then
        print("üö´ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º " .. player.Name .. " (–≤ –∑–æ–Ω–µ —Å–ø–∞–≤–Ω–∞)")
        return false
    end
    
    local humanoid = player.Character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then
        return false
    end
    
    return true
end

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à
function TeleportScript:HandleInput(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.R then
        if input.UserInputType == Enum.UserInputType.Keyboard then
            if input.UserInputState == Enum.UserInputState.Begin then
                self:ToggleTeleport()
            end
        end
    end
end

-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
function TeleportScript:ToggleTeleport()
    self.Enabled = not self.Enabled
    
    if self.Enabled then
        print("‚úÖ –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –í–ö–õ–Æ–ß–ï–ù–ê (R –¥–ª—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è)")
        if not self.Connection then
            self:StartTeleportation()
        end
    else
        print("‚õî –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –í–´–ö–õ–Æ–ß–ï–ù–ê (R –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è)")
        if self.Connection then
            self.Connection:Disconnect()
            self.Connection = nil
        end
    end
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function TeleportScript:CheckLocalPlayerAlive()
    if not LocalPlayer.Character then return false end
    if not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return false end
    local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
    return humanoid and humanoid.Health > 0
end

-- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ —â–∏—Ç
function TeleportScript:HasShield(player)
    if not player or not player.Character then return false end
    
    local character = player.Character
    local lower = string.lower
    
    -- 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —â–∏—Ç—ã (ForceField)
    if character:FindFirstChildOfClass("ForceField") then
        return true
    end
    
    -- 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–∞—Å—Ç–∏—Ü—ã —â–∏—Ç–∞ (Sparkles, ParticleEmitter)
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º Sparkles (—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —â–∏—Ç–æ–≤)
            if part:FindFirstChildWhichIsA("Sparkles") then
                return true
            end
            
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º ParticleEmitter (—É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–≤–µ—Ç–∞)
            local particle = part:FindFirstChildWhichIsA("ParticleEmitter")
            if particle then
                local particleName = lower(particle.Name)
                for _, keyword in ipairs(self.ShieldKeywords) do
                    if particleName:find(keyword) then
                        return true
                    end
                end
            end
        end
    end
    
    -- 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    for _, item in ipairs(character:GetChildren()) do
        if item:IsA("Tool") or item:IsA("Accessory") then
            local itemName = lower(item.Name)
            for _, keyword in ipairs(self.ShieldKeywords) do
                if itemName:find(keyword) then
                    return true
                end
            end
        end
    end
    
    -- 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å (Backpack)
    if player:FindFirstChild("Backpack") then
        for _, item in ipairs(player.Backpack:GetChildren()) do
            local itemName = lower(item.Name)
            for _, keyword in ipairs(self.ShieldKeywords) do
                if itemName:find(keyword) then
                    return true
                end
            end
        end
    end
    
    -- 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (Humanoid)
    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        for _, effect in ipairs(humanoid:GetChildren()) do
            local effectName = lower(effect.Name)
            for _, keyword in ipairs(self.ShieldKeywords) do
                if effectName:find(keyword) then
                    return true
                end
            end
            
            -- –ü—Ä–æ–≤–µ—Ä—è–µ–º BoolValue —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
            if effect:IsA("BoolValue") and effect.Value == true then
                local effectName = lower(effect.Name)
                if effectName:find("shield") or effectName:find("protected") then
                    return true
                end
            end
        end
    end
    
    return false
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∏–≥—Ä–æ–∫ –≤ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
function TeleportScript:IsInForbiddenArea(player)
    if not player or not player.Character then return false end
    
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    local playerPosition = humanoidRootPart.Position
    local distance = (playerPosition - self.ForbiddenPosition).Magnitude
    
    return distance <= self.ForbiddenRadius
end

-- –ü–æ–∏—Å–∫ —Ü–µ–ª–∏ –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ (—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∫ —Ü–µ–ª–∏ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
function TeleportScript:GetTargetPlayer()
    if not self:CheckLocalPlayerAlive() then return nil end
    
    -- –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é —Ü–µ–ª—å –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    local priorityTarget = self:GetPriorityTarget()
    if priorityTarget and self:IsValidTarget(priorityTarget) then
        -- –° —à–∞–Ω—Å–æ–º PriorityTargetChance –≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é —Ü–µ–ª—å
        if math.random(1, 100) <= self.PriorityTargetChance then
            print("üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Ü–µ–ª—å: " .. priorityTarget.Name)
            return priorityTarget
        end
    end
    
    -- –ï—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Ü–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —à–∞–Ω—Å –Ω–µ –≤—ã–ø–∞–ª, –∏—â–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    local alivePlayers = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and self:IsValidTarget(player) then
            table.insert(alivePlayers, player)
        end
    end
    
    if #alivePlayers > 0 then
        local target = alivePlayers[math.random(1, #alivePlayers)]
        print("üéØ –°–ª—É—á–∞–π–Ω–∞—è —Ü–µ–ª—å: " .. target.Name)
        return target
    end
    
    print("‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ü–µ–ª–µ–π –¥–ª—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏")
    return nil
end

-- –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Å –æ—Ç—Å—Ç—É–ø–æ–º –Ω–∞–∑–∞–¥ –∏ –≤–Ω–∏–∑
function TeleportScript:TeleportToPlayer(player)
    if not player or not player.Character or not self:CheckLocalPlayerAlive() then 
        return false 
    end
    
    local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then 
        print("‚ö†Ô∏è –£ —Ü–µ–ª–∏ –Ω–µ—Ç HumanoidRootPart: " .. player.Name)
        return false 
    end
    
    local targetCFrame = humanoidRootPart.CFrame
    local lookVector = targetCFrame.LookVector
    local upVector = targetCFrame.UpVector
    
    -- –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å –æ—Ç—Å—Ç—É–ø–æ–º –Ω–∞–∑–∞–¥ –∏ –≤–Ω–∏–∑
    local backwardOffset = targetCFrame.Position - (lookVector * self.BackwardOffset)
    local finalPosition = backwardOffset - (upVector * self.DownwardOffset)
    
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        -- –°–æ–∑–¥–∞–µ–º CFrame —Å–º–æ—Ç—Ä—è—â–∏–π –Ω–∞ —Ü–µ–ª—å, –Ω–æ —Å —Å–º–µ—â–µ–Ω–∏–µ–º –≤–Ω–∏–∑
        local targetPosition = targetCFrame.Position
        local lookCFrame = CFrame.new(finalPosition, Vector3.new(targetPosition.X, finalPosition.Y, targetPosition.Z))
        
        LocalPlayer.Character.HumanoidRootPart.CFrame = lookCFrame
        print("üì° –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –∫ " .. player.Name)
        return true
    end
    return false
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–º–µ–Ω—ã —Ü–µ–ª–∏
function TeleportScript:ShouldSwitchTarget()
    local currentTime = os.time()
    
    -- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ RandomSwitchInterval —Å–µ–∫—É–Ω–¥
    if currentTime - self.LastRandomSwitch >= self.RandomSwitchInterval then
        self.LastRandomSwitch = currentTime
        return true
    end
    
    -- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    if not self:CheckLocalPlayerAlive() then return true end
    if not self.CurrentTarget then return true end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –µ—â–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ —Ç–µ–∫—É—â–µ–π —Ü–µ–ª–∏
    if not self:IsValidTarget(self.CurrentTarget) then
        print("üîÑ –°–º–µ–Ω–∞ —Ü–µ–ª–∏: —Ç–µ–∫—É—â–∞—è —Ü–µ–ª—å –Ω–µ–≤–∞–ª–∏–¥–Ω–∞")
        return true
    end
    
    local character = self.CurrentTarget.Character
    if not character then return true end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ HumanoidRootPart —É —Ç–µ–∫—É—â–µ–π —Ü–µ–ª–∏
    if not character:FindFirstChild("HumanoidRootPart") then
        print("üîÑ –°–º–µ–Ω–∞ —Ü–µ–ª–∏: —É —Ç–µ–∫—É—â–µ–π —Ü–µ–ª–∏ –Ω–µ—Ç HumanoidRootPart")
        return true
    end
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞—à–µ–ª –ª–∏ —Ç–µ–∫—É—â–∞—è —Ü–µ–ª—å –≤ –∑–æ–Ω—É —Å–ø–∞–≤–Ω–∞
    if self:IsInSpawnArea(self.CurrentTarget) then
        print("üîÑ –°–º–µ–Ω–∞ —Ü–µ–ª–∏: —Ç–µ–∫—É—â–∞—è —Ü–µ–ª—å –≤ –∑–æ–Ω–µ —Å–ø–∞–≤–Ω–∞")
        return true
    end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return true end
    if currentTime - self.LastTargetChange >= self.TargetSwitchTime then return true end
    
    return false
end

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
function TeleportScript:Update()
    if not self.Enabled then return end
    
    if not self:CheckLocalPlayerAlive() then
        if self.CurrentTarget then
            self.CurrentTarget = nil
        end
        return
    end
    
    if self:ShouldSwitchTarget() then
        self.CurrentTarget = self:GetTargetPlayer()
        self.LastTargetChange = os.time()
    end
    
    if self.CurrentTarget then
        self:TeleportToPlayer(self.CurrentTarget)
    end
end

-- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–º–µ—Ä—Ç–∏ –≤–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
function TeleportScript:TrackCharacter()
    if self.CharacterConnection then
        self.CharacterConnection:Disconnect()
    end
    
    self.CharacterConnection = LocalPlayer.CharacterAdded:Connect(function(character)
        self.CurrentTarget = nil
        self.LastTargetChange = 0
        self.LastRandomSwitch = 0
        print("üîÑ –ü–µ—Ä—Å–æ–Ω–∞–∂ –ø–µ—Ä–µ—Ä–æ–¥–∏–ª—Å—è, —Å–±—Ä–æ—Å —Ü–µ–ª–µ–π")
    end)
end

-- –ó–∞–ø—É—Å–∫ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ —Ü–∏–∫–ª)
function TeleportScript:StartTeleportation()
    if self.Connection then
        self.Connection:Disconnect()
    end
    
    self.Connection = RunService.Heartbeat:Connect(function()
        self:Update()
    end)
end

-- –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
function TeleportScript:Start()
    -- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    self:TrackCharacter()
    
    -- –ó–∞–ø—É—Å–∫ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
    self:StartTeleportation()
    
    -- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–ª–∞–≤–∏—à
    if self.InputConnection then
        self.InputConnection:Disconnect()
    end
    
    self.InputConnection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        self:HandleInput(input, gameProcessed)
    end)
    
    -- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —Å–ø–∞–≤–Ω–∞
    self:UpdateSpawnCache()
    
    print("‚úÖ –°–∫—Ä–∏–ø—Ç —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –∑–∞–ø—É—â–µ–Ω!")
    print("üéÆ –ù–∞–∂–º–∏—Ç–µ R –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏")
    print("üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ü–µ–ª–∏ –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: " .. self.PriorityTargetChance .. "%")
    print("üîÅ –ê–≤—Ç–æ—Å–º–µ–Ω–∞ —Ü–µ–ª–∏ –∫–∞–∂–¥—ã–µ " .. self.RandomSwitchInterval .. " —Å–µ–∫—É–Ω–¥")
    print("‚¨áÔ∏è  –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑: " .. self.DownwardOffset .. " studs")
    print("üõ°Ô∏è  –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ —Å —â–∏—Ç–æ–º")
    print("üö´ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–æ–Ω–µ (-6, 958, -42)")
    print("üè† –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∑–æ–Ω–µ —Å–ø–∞–≤–Ω–∞")
    print("‚ö†Ô∏è  –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –±–µ–∑ HumanoidRootPart")
end

-- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞
function TeleportScript:Stop()
    if self.Connection then
        self.Connection:Disconnect()
        self.Connection = nil
    end
    if self.CharacterConnection then
        self.CharacterConnection:Disconnect()
        self.CharacterConnection = nil
    end
    if self.InputConnection then
        self.InputConnection:Disconnect()
        self.InputConnection = nil
    end
    self.Enabled = false
    print("‚õî –°–∫—Ä–∏–ø—Ç —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å–º–µ–Ω—ã —Ü–µ–ª–∏
function TeleportScript:SetSwitchInterval(seconds)
    self.RandomSwitchInterval = seconds
    print("üïí –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–º–µ–Ω—ã —Ü–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " .. seconds .. " —Å–µ–∫")
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–Ω—Å–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π —Ü–µ–ª–∏
function TeleportScript:SetPriorityChance(percent)
    self.PriorityTargetChance = math.clamp(percent, 0, 100)
    print("üéØ –®–∞–Ω—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " .. percent .. "%")
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–º–µ—â–µ–Ω–∏—è –≤–Ω–∏–∑
function TeleportScript:SetDownwardOffset(offset)
    self.DownwardOffset = offset
    print("‚¨áÔ∏è  –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: " .. offset .. " studs")
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–¥–∏—É—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–∞–≤–Ω–∞
function TeleportScript:SetSpawnCheckRadius(radius)
    self.SpawnCheckRadius = radius
    print("üè† –†–∞–¥–∏—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–æ–Ω—ã —Å–ø–∞–≤–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " .. radius .. " studs")
end

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–π –∑–æ–Ω—ã
function TeleportScript:SetForbiddenZone(position, radius)
    self.ForbiddenPosition = position or Vector3.new(-6, 958, -42)
    self.ForbiddenRadius = radius or 10
    print("üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: " .. tostring(position) .. ", —Ä–∞–¥–∏—É—Å: " .. radius)
end

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è —â–∏—Ç–æ–≤
function TeleportScript:AddShieldKeyword(keyword)
    table.insert(self.ShieldKeywords, string.lower(keyword))
    print("üîç –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: " .. keyword)
end

-- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —Å–ø–∞–≤–Ω–∞
function TeleportScript:ForceUpdateSpawnCache()
    self.LastSpawnUpdate = 0
    self:UpdateSpawnCache()
end

-- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
TeleportScript:Start()

-- –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
-- TeleportScript:SetSwitchInterval(5) -- —Å–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª
-- TeleportScript:SetPriorityChance(90) -- —É–≤–µ–ª–∏—á–∏—Ç—å —à–∞–Ω—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π —Ü–µ–ª–∏
-- TeleportScript:SetDownwardOffset(2) -- —É–≤–µ–ª–∏—á–∏—Ç—å —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑
-- TeleportScript:SetSpawnCheckRadius(30) -- —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–¥–∏—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–∞–≤–Ω–∞
-- TeleportScript:ForceUpdateSpawnCache() -- –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à —Å–ø–∞–≤–Ω–∞
-- TeleportScript:AddShieldKeyword("bubble") -- –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ –¥–ª—è —â–∏—Ç–∞
